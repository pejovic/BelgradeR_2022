---
title: "Analiza geo-prostornih podataka u R-u"
subtitle: "Startit, BelgradeR meetup"
author: "Milutin Pejoviƒá & Petar Bursaƒá"
date: ""
output:
  xaringan::moon_reader:
    seal: false
    lib_dir: libs
    css: ["xaringan-themer.css", "style.css"]
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      ratio: 16:9
      titleSlideClass: [left, bottom, inverse]
---

class: inverse, left, nonum, clear

background-image: url("figures/ArcGISBook_Header.jpg")
background-size: cover

.titlestyle1[Analiza geo-prostornih podataka u R-u] 
<br><br><br>


<link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Lora" />

<br><br><br><br>

.titlestyle[Milutin Pejoviƒá & Petar Bursaƒá]

.titlestyle[2022-12-14, Startit, Beograd]

---
# O nama

.pull-left[

```{r, purl=FALSE,echo=FALSE, out.width="50%", fig.align='center'}
knitr::include_graphics("figures/MilutinPejovic_crop.jpg")
```

.center[**doc. dr Milutin Pejoviƒá, dipl.geod.in≈æ.**]

]


.pull-right[

```{r, purl=FALSE,echo=FALSE, out.width="50%", fig.align='center'}
knitr::include_graphics("figures/PetarBursac.jpg")
```

.center[**Petar Bursac, dipl.geod.in≈æ.**]

]

----

.center[**Graƒëevinski fakultet Univerziteta u Beogradu**]
.center[**Odsek za Geodeziju i Geoinformatiku**]


---
# O nama

- 2004 - Master akademske studije Geoinformatike.

- 2008 - Laboratorija za razvoj geoporostornih tehnologija otvorenog koda [OSGL](http://osgl.grf.bg.ac.rs/en/)

- Kursevi i konferencije:

  - 2007 - GEOSTAT Belgrade workshop  - lectures: Tomislav Hengl
  
  - 2011 - GEOSTAT 2011 workshop - lectures: Victor Olaya, Tomislav Hengl
  
  - 2014 - World Daily Meteo Conference - keynote speakers: Edzer Pebesma, Gerard Heuvelink, Tomislav Hengl
  
  - 2016 - GeoMLA (Geostatistics and Machine Learning) conference; keynote speakers: Mikhail Kanevski, Mirko Orliƒá, Wolfgang Wagner, Ole Einar Tveito, Tomislav Hengl. 

- 2022 - <font color='red'>Geoinformatika</font> - novi studijski program na Graƒëevinskom fakultetu 

---
class: inverse, center, middle,
# ≈†ta su to geo-prostorni podaci?

---
# ≈†ta su to geo-prostorni podaci?

.pull-left[

.tiny[

- **Kombinuju informaciju sa <font color='red'>geografskom lokacijom i vremenom </font> geografskom lokacijom i vremenom na koje se odnose**

- **Geo-prostorni vs. prostorni podaci**

- **Digitalno predstavljaju prirodne i antropogene objekte, prostorne pojave i dogadjaje stavljajuƒái ih u kontekst geografskog prostora**
]

]

.pull-right[


```{r, echo=FALSE, out.width='100%', fig.align='center'}
knitr::include_graphics('figures/Geographic_information.png')

```

```{r, echo=FALSE, out.width='80%', fig.align='center'}
knitr::include_graphics('figures/space_time_1.png')

```

]


---
# Izvori geo-prostornih podataka

.pull-left[

.tiny[

- **Javni podaci dr≈æavnih slu≈æbi (prostorni inventari, premer, popis i mape)**

- **Podaci permanentnih stanica i senzora (senzori)**

- **Podaci daljinske detekcije (navigacija i satelitski snimci)**

- **Personalni podaci i podaci sa dru≈°tvenih mre≈æa**
]

]

.pull-right[


```{r, echo=FALSE, out.width='60%', fig.align='center'}
knitr::include_graphics('figures/data_layers_2.jpg')

```

```{r, echo=FALSE, out.width='80%', fig.align='center'}
knitr::include_graphics('figures/lidar-vs-photogrammetry-drone.jpg')

```

]

---
# Primeri primene geo-prostornih podataka

.pull-left[

.tiny[

- **Ekologija**
- **Daljinska detekcija (satelitski snimci)**
- **Ekonomija**
- **Demografija**
- **Arheologija**
- **Transport**
- **Klimatologija**
- **Meteorologija** 
- **Geo-morfometrija**
- **Hidrologija**
- **Urbano planiranje**
- **Rudarstvo**
- **Zemlji≈°te**
- **Turizam**
- **i mnogi drugi...**

]

]

.pull-right[

```{r, out.width="95%", echo=FALSE}
knitr::include_graphics("figures/montbayabove.gif")
```
 
```{r, echo=FALSE, out.width="95%"}
knitr::include_graphics("figures/water-detection.png")
```

]


---
# Tipovi geo-prostornih podataka

.pull-left[

## <font color='red'>Vektorski podaci</font>

.tiny[

- **Taƒçke, linije, poligoni (kombinacije osnovnih geometrijskih entiteta)**

- **Predstavljaju diskretne objekte u prostoru**

  - **Uzorkovanja (merenja) na odreƒëenim lokacijama**
  
  - **Granice podruƒçja**
  
  - **Trase i trajektorije**
  
- **Poznati fajl formati: ESRI Shapefile (.shp, .shx, .dbf, .prj), GeoJSON, GPX (.gpx), geopackage (.gpk)**


]

]

.pull-right[


```{r, echo=FALSE, out.width='35%', fig.align='center'}
knitr::include_graphics('figures/vector_1.png')

```
`

]



---
# Tipovi geo-prostornih podataka

.pull-left[

## <font color='red'>Rasterski podaci</font>

.tiny[

- **Rasterski podaci predstavljaju mozaik manjih poligona (ƒáelija), najƒçe≈°ƒáe kvadratnih i jednakih dimenzija, u kojem svaka ƒçelija predstavlja vrednost prostornog fenomena u odgovarajuƒáoj prostornoj oblasti na koju se ƒçelija odnosi, u odreƒëenom trenutku**

- **Prirodni format satelitskih i aero-snimaka zemlje iz vazduha**

- **Odgovarajuƒçi za predstavljanje kontinualnih objekata u prostoru (temperatura, nadmosrska visina, itd)**

- **Poznati fajl formati: GeoTIFF, Erdas Imagine Image (.img), HDF (.hdf), NetCDF (.nc)**


]

]

.pull-right[


```{r, echo=FALSE, out.width='35%', fig.align='center'}
knitr::include_graphics('figures/raster_1.png')

```
`

]


---
# Vi≈°edimenzionalne strukture geo-prostornih podataka

.pull-left[

## <font color='red'>Data cubes</font>

.tiny[

- **Ukljuƒçivanje vremenske komponente u prostorne podatke**

  - **tro-dimenzionalni podaci (vektor)**
  
  - **ƒçetvoro-dimenzionalni podaci (raster)**
  
  - **vi≈°e-dimenzionlani podaci**

- **Odgovarajuƒçi za predstavljanje podataka prostornog monitoringa**

]

]

.pull-right[


```{r, echo=FALSE, out.width='45%', fig.align='center'}
knitr::include_graphics('figures/space_time_1.png')

```


```{r, echo=FALSE, out.width='70%', fig.align='center'}
knitr::include_graphics('figures/fig-cube4d-1.png')

```


```{r, echo=FALSE, out.width='45%', fig.align='center'}
knitr::include_graphics('figures/space_time_raster.png')

```

]

---
# Osobine geo-prostornih podataka

.pull-left[


.tiny[

</br>
</br>

- **Koordinate i koordinatni sistem**

</br>
</br>
</br>
  
- **Geometrija**

</br>
</br>

- **Atributi i razmera**

]

]

.pull-right[


```{r, echo=FALSE, out.width='65%', fig.align='left'}
knitr::include_graphics('figures/CS-article-1.jpg')

```


```{r, echo=FALSE, out.width='80%', fig.align='left'}
knitr::include_graphics('figures/2019-points-lines-polygons.png')

```


```{r, echo=FALSE, out.width='80%', fig.align='left'}
knitr::include_graphics('figures/Point_Attribute_Table.png')

```

]

---
# Koordinate i Koordinatni Referenti Sistem (CRS)


.center[
***<font color='red'>"Data are not just numbers, they are numbers with a context; ‚ÄúIn data analysis, context provides meaning‚Äù</font>*** ([Cobb and Moore, 1997](http://www.jstor.org/stable/2975286))
]

.center[
***<font color='red'>"Coordinates are not just numbers, they are numbers with a spatial context‚Äù</font>***
]

----

**Koordinatni referentni sistem predstavlja set informacija kojim se opisuje geografski prostoru u matematiƒçkom smislu (u odnosu na Zemlju):**

**On ukljuƒçuje:**

- set matematiƒçkih pravila kojim se defini≈°e kako se koordinate dodeljuju taƒçkama u prostoru
- set parametara koji defini≈°u poziciju poƒçetka koordiatnog sistema, razmera i orijentacija koordinatnog sistema (datum)

----

**Mo≈æemo razlikovati dve glavne grupe koordinatnih referentih sistema: <font color='red'>Geografski koordinatni sistemi</font> i <font color='red'>Koordinatni sistemi u projekciji</font>**



---
# Geografski (geodetski) koordinatni sistem


.pull-left[

- **Podrzumevaju definisane: elipsoid, poƒçetni meridian (podrazumevan), datum**

</br>


- **Odreƒëuju poziciju u okviru elipsoidnog koordinatnog referentnog sistema**

  - **Geografska ≈°irina i du≈æina (Latitude, longitude) i elispoidna visina**
  
  - **Geocentriƒçni metriƒçki sistem (X, Y, Z)**
  
]


.pull-right[

```{r echo=FALSE, massage=FALSE}

suppressPackageStartupMessages(suppressWarnings(library(sf)))
suppressPackageStartupMessages(suppressWarnings(library(here)))
suppressPackageStartupMessages(suppressWarnings(library(tmap)))
suppressPackageStartupMessages(suppressWarnings(library(tidyverse)))

GK <- "+proj=tmerc +lat_0=0 +lon_0=21 +k=0.9999 +x_0=7500000 +y_0=0 +ellps=bessel +towgs84=574.027,170.175,401.545,4.88786,-0.66524,-13.24673,0.99999311 +units=m"

srbija <- suppressMessages(st_read(here::here("data", "Srbija", "RAP.shp"), quiet = TRUE))

srbija_wgs <- st_transform(srbija, 4326)

srbija_gk <- st_transform(srbija, GK)

ggplot(srbija) + geom_sf() + theme_bw()

```

]
---
# Koordinatni sistemi u projekciji

.pull-left[

- **Podrzumevaju definisane: elipsoid, poƒçetni meridian (podrazumevan), datum i parametre projekcije**

</br>

- **Pozicija se odreƒëuje pravouglim koordinatama (Easting, Northing)**

]

.pull-right[

```{r echo=FALSE}

ggplot(srbija_gk) + geom_sf() + coord_sf(datum = st_crs(GK)) + theme_bw()

```

]

---
# Opis koordinatnog sistema


.pull-left[
**Dva prustupa su najzastupljenija:**

- CRS codes, e.g., EPSG:4326
- `WKT2`

**Do sada najzastupljeniji, ali u svom zalasku:**

- `proj4string` - `r st_crs(4326)$proj4string`

----

*Vi≈°e informacija:*

.tiny[
- https://proj.org/usage/projections.html
- https://spatialreference.org/ref/epsg/
- https://www.youtube.com/watch?v=Va0STgco7-4 
- https://www.gaia-gis.it/fossil/libspatialite/wiki?name=PROJ.6

]

]

.pull-right[
.tiny[
```{r, purl=FALSE,echo=FALSE}
st_crs(4326)
```
]
]


---
# ≈†ta obuhvata analiza geo-prostornih podataka?

1. **Uƒçitavanje i ispisivanje prostornih podataka**
2. **Skladi≈°tenje i manipulacija podacima (klase i metode)**
3. **Deskriptivna i ekspanatorna analiza podataka**
4. **GIS analiza i kartiranje**
5. **Prostorna statistiƒçna analiza (da li neka pojava mo≈æe biti predstavljena statistiƒçkim modelom**
6. **Modeliranje i prostorna predikcija**
7. **Komunikacija**




---
# OSGeo biblioteke

.left-column[
**[PROJ](https://www.osgeo.org/projects/proj/)**

- "Konverzija koordinata"
- Prva verzija [1970s](https://en.wikipedia.org/wiki/PROJ#cite_note-Kresse_Danko_2011_p._948-3)

**[GDAL](https://www.osgeo.org/projects/gdal/)**

- Geospatial Data Abstraction Library, prva verzija 2000
- "200+ geo-prostornih fajl formata"

**[GEOS](https://www.osgeo.org/projects/gdal/)**

- Geometry Engine ‚Äì Open Source

]
.right-column[
<a href="https://www.osgeo.org/">
```{r, echo=FALSE, out.width="80%"}
knitr::include_graphics("https://www.osgeo.org/wp-content/themes/roots/assets/img/logo-osgeo.svg")
```
</a>

```{r, echo=FALSE, out.width="90%", fig.cap="GEOS build matrix"}
knitr::include_graphics("figures/GEOS.png")
```

.caption[Source: https://trac.osgeo.org/geos]

- Access to these three libraries used to require **sp**, **rgdal** and **rgeos**
- Now **sf** provides a unified access to all three üéâ

]



```{r setup2, include=FALSE, purl=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(fig.align = "center", cache = FALSE, fig.height = 5, echo = TRUE)
knitr::opts_chunk$set(root.dir = normalizePath("."))
```

```{r, purl=FALSE,echo=FALSE, message=FALSE}
library(sf)
## sfc objects creation ---------
point_sfc = st_sfc(st_point(c(1, 1)), crs = 4326)
linestring_sfc = st_sfc(st_linestring(rbind(c(0.8, 1), c(0.8, 1.2), c(1, 1.2))), crs = 4326)
polygon_sfc = st_sfc(st_polygon(list(rbind(
  c(1.2, 0.6), c(1.4, 0.6), c(1.4, 0.8), c(1.2, 0.8), c(1.2, 0.6)
))), crs = 4326)
multipoint_sfc = st_sfc(st_multipoint(rbind(c(1, 0.6), c(1.4, 1.1))), crs = 4326)
multipoint_sfc2 = multipoint_sfc - 0.5
multilinestring_sfc = st_sfc(st_multilinestring(list(rbind(
  c(1.2, 1), c(1.2, 1.4)
),
rbind(
  c(1.4, 0.4), c(1.6, 0.6), c(1.6, 0.8)
))), crs = 4326)
multipolygon_sfc = st_sfc(st_multipolygon(list(list(rbind(
  c(1.4, 1.2), c(1.6, 1.4), c(1.4, 1.4), c(1.4, 1.2)
)),
st_polygon(
  list(rbind(
    c(0.6, 0.6), c(0.9, 0.6), c(0.9, 0.9), c(0.6, 0.9), c(0.6, 0.6)
  ),
  rbind(
    c(0.7, 0.7), c(0.8, 0.8), c(0.8, 0.7), c(0.7, 0.7)
  ))
))),
crs = 4326)
## sf objects creation ---------
point_sf = st_sf(geometry = point_sfc)
linestring_sf = st_sf(geometry = linestring_sfc)
polygon_sf = st_sf(geometry = polygon_sfc)
multipoint_sf = st_sf(geometry = c(multipoint_sfc, multipoint_sfc2))
multilinestring_sf = st_sf(geometry = multilinestring_sfc)
multipolygon_sf = st_sf(geometry = multipolygon_sfc)
geometrycollection_sf = st_cast(
  c(
    point_sfc,
    linestring_sfc,
    polygon_sfc,
    multipoint_sfc,
    multilinestring_sfc,
    multipolygon_sfc
  ),
  "GEOMETRYCOLLECTION"
)
```





---
class: inverse, center, middle,
# Za≈°to je R fantastiƒçno okru≈æenje za rad sa prostornim podacima?

---
# Za≈°to R za analizu geo-prostornih podataka?

- Moguƒáa je kompletna analiza
- Lako podeliti kartu sa drugima (email, html...)

---
class: inverse, center, middle, 

# <font color='red'>terra paket</font>


---
# Klase rasterskih podataka u <font color='red'>terra</font> paketu

**`terra`** paket omoguƒáava metode za manipulaciju i rad sa prostornim podacima u rasterskom i vektorskom formatu. Osnovne klase u `terra` paketu su sledeƒáe

* **`SpatRaster`**

* **`SpatVector`**

* **`SpatExtent`**

---
# <font color='red'>SpatRaster</font>

</br>

**`SpatRaster`** je multi-lejer objekat koji je namenjen radu sa velikim rasterskim podacima koji ne mogu biti skaldi≈°teni u radnom memoriji raƒçunara.  On skladi≈°ti niz osnovnih parametara koji ga opisuju. To ukljuƒçuje broj kolona i redova, koordinate njegovog prostornog obuhvata (eng. extent) i koordinatni referentni sistem (projekcija). Pored toga, SpatRaster mo≈æe da skladi≈°ti informacije o fajlovima u kojima se ƒçuvaju vrednosti rasterskih ƒáelija. 




